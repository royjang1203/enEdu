generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Word {
  id        String   @id @default(cuid())
  word      String
  pos       String
  meaningKo String
  level     String   // A1, A2, B1, B2
  example   String
  tagsJson  String   @default("[]")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([level])
  @@index([word])
}

model GrammarTopic {
  id                 String   @id @default(cuid())
  title              String
  level              String   // A1, A2, B1, B2 (or MIX)
  ruleSummary        String
  examplesJson       String   @default("[]")
  commonMistakesJson String   @default("[]")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([level])
  @@index([title])
}

model Attempt {
  id          String   @id @default(cuid())
  deviceId    String
  kind        String   // vocab|grammar
  questionId  String
  sourceId    String   // Word.id or GrammarTopic.id
  type        String   // mcq|blank
  level       String
  prompt      String
  choicesJson String   @default("[]")
  answer      String
  chosen      String
  isCorrect   Boolean
  explanation String
  createdAt   DateTime @default(now())

  @@index([deviceId, createdAt])
  @@index([deviceId, isCorrect])
  @@index([kind, sourceId])
}

model ReviewState {
  id           String   @id @default(cuid())
  deviceId     String
  kind         String   // vocab|grammar
  sourceId     String   // Word.id or GrammarTopic.id
  level        String
  streak       Int      @default(0)
  intervalDays Int      @default(0)
  easeFactor   Float    @default(2.5)
  nextReviewAt DateTime @default(now())
  isMastered   Boolean  @default(false)
  updatedAt    DateTime @updatedAt
  createdAt    DateTime @default(now())

  @@unique([deviceId, kind, sourceId])
  @@index([deviceId, kind, nextReviewAt])
  @@index([deviceId, isMastered])
}
